<html>
<body>
<h1>${instances.size()} instance(s)</h1>
<div id="instances" style="padding: 2px; border: 1px solid black" >
<ul>
   	
   	#{list items:instances, as:'instance'}
        <li>
            vehicleId: ${instance.vehicleId}, 
            recordsProcessed: ${instance.recordsProcessed}
            #{if instance.totalRecords > 0}/${instance.totalRecords}
            #{/if}<br>
            #{if instance.simulation}
            Simulation Initial Parameters:
            <ul>
              <li> obsCov: ${instance.simParameters.obsCov} </li>
<!--               <li> obsCovDof: ${instance.simParameters.obsCovDof} </li> -->
              <li> onRoadStateCov: ${instance.simParameters.onRoadStateCov} </li>
<!--               <li> onRoadStateCovDof: ${instance.simParameters.onRoadCovDof} </li> -->
              <li> offRoadStateCov: ${instance.simParameters.offRoadStateCov} </li>
<!--               <li> offRoadStateCovDof: ${instance.simParameters.offRoadCovDof} </li> -->
              <li> offTransitionProbs: ${instance.simParameters.offTransitionProbs} </li>
              <li> onTransitionProbs: ${instance.simParameters.onTransitionProbs} </li>
              <li> initialObsFreq: ${instance.simParameters.initialObsFreq} </li>
              <li> roadFilterTypeName: ${instance.simParameters.roadFilterTypeName} </li>
              <li> seed: ${instance.simSeed} </li>
            </ul>
            #{/if}
            Initial Filter Parameters:
            <ul>
              <li> obsCov: ${instance.initialParameters.obsCov} </li>
              <li> obsCovDof: ${instance.initialParameters.obsCovDof} </li>
              <li> onRoadStateCov: ${instance.initialParameters.onRoadStateCov} </li>
              <li> onRoadStateCovDof: ${instance.initialParameters.onRoadCovDof} </li>
              <li> offRoadStateCov: ${instance.initialParameters.offRoadStateCov} </li>
              <li> offRoadStateCovDof: ${instance.initialParameters.offRoadCovDof} </li>
              <li> offTransitionProbs: ${instance.initialParameters.offTransitionProbs} </li>
              <li> onTransitionProbs: ${instance.initialParameters.onTransitionProbs} </li>
              <li> numParticles: ${instance.initialParameters.numParticles} </li>
              <li> initialObsFreq: ${instance.initialParameters.initialObsFreq} </li>
              <li> particleFilterTypeName: ${instance.initialParameters.particleFilterTypeName} </li>
              <li> roadFilterTypeName: ${instance.initialParameters.roadFilterTypeName} </li>
              <li> seed: ${instance.simSeed} </li>
            </ul>
            <span>
                <a href="/application/removeInferenceInstance?vehicleId=${instance.vehicleId}">Delete</a> 
                <a href="/application/map?vehicleId=${instance.vehicleId}" target="_blank">View Map</a> 
                <a href="/api/traces?vehicleId=${instance.vehicleId}" target="_blank">View Traces</a> 
<!--                 <a href="/api/getPerformanceResults?vehicleId=${instance.vehicleId}" target="_blank">View Perf. Results</a>  -->
                <a href="/application/dataPlot?vehicleId=${instance.vehicleId}" target="_blank">View Perf. Results</a> 
                <a href="/api/getOffRoadPaths?vehicleId=${instance.vehicleId}&recordNumber=${instance.recordsProcessed-1}" target="_blank">View Off-Road Paths</a> 
            </span>
        </li>
    #{/list}
</ul>
</div>

<div id="simulate" style="padding: 2px; border: 1px solid black">
<h3>Generate Simulation</h3> The values below are used to generate states for a simulation.  
If inference is performed on the simulation data, then the default initial parameters are used to initialize states
(not the values below), unless the "use initial sim parameters as state parameters" option is set.
	#{form @Application.simulation(), method:'GET'}
    <select name="particleFilterTypeName">
     	#{list items:particleFilters, as:'particleFilter'}
      <option value="${particleFilter}">${particleFilter}</option>
      #{/list}
    </select><br>
    <select name="roadFilterTypeName">
     	#{list items:roadFilters, as:'roadFilter'}
      <option value="${roadFilter}">${roadFilter}</option>
      #{/list}
    </select><br>
	 	<input name="seed_str" type="text" value="1234567890"/>
	   <label for="seed_str">Random seed (enter 0 for none)</label><br>
	 	<input name="start_coordinate_pair" type="text" value=""/> 
	   <label for="start_coordinate_pair">Start coordinates (lat,lon)</label><br>
	 	<input name="start_unix_time" type="text" value="1325570441000"/> 
	   <label for="start_unix_time">Start (unix) time * 1000</label><br>
	 	<input name="duration_str" type="text" value="3600"/> 
	   <label for="duration_str">Duration (secs)</label><br>
	 	<input name="frequency_str" type="text" value="30"/> 
	   <label for="frequency_str">Observation Frequency (secs)</label><br>
	 	<input name="obs_variance_pair" type="text" value="100, 100"/> 
	   <label for="obs_variance_pair">Observation Variance (x,y) in meters</label><br>
	 	<input name="obsCovDof_str" type="text" value="20"/> 
	   <label for="obsCovDof_str">Observation Variance Prior Degrees of Freedom</label><br>
	 	<input name="road_state_variance" type="text" value="6.25e-4"/> 
	   <label for="road_state_variance">On-road State Variance (errors due to acceleration)</label><br>
	 	<input name="roadCovDof_str" type="text" value="20"/> 
	   <label for="roadCovDof_str">On-road State Variance Prior Degrees of Freedom</label><br>
	 	<input name="ground_state_variance_pair" type="text" value="6.25e-4, 6.25e-4"/> 
	    <label for="ground_state_variance_pair">Off-road State Variance (errors due to acceleration, (x,y))</label><br>
	 	<input name="groundCovDof_str" type="text" value="20"/> 
	   <label for="groundCovDof_str">Off-road State Variance Prior Degrees of Freedom</label><br>
	 	<input name="off_prob_pair" type="text" value="5, 95"/>
	    <label for="off_prob_pair">Off- to off-road, off- to on-road weights (unnormalized)</label><br>
	 	<input name="on_prob_pair" type="text" value="95, 5"/>
	    <label for="on_prob_pair">On- to on-road, on- to off-road weights (unnormalized)</label><br>
	 	<input name="numParticles_str" type="text" value="25"/>
	    <label for="numParticles_str">Number of particles</label><br>
	 	<input name="initialObsFreq_str" type="text" value="30"/>
	    <label for="initialObsFreq_str">Initial Observation Frequency (seconds)</label><br>
	 	<input name="performInference" id="performInference" type="checkbox" value="true" checked="checked"/>
	    <label for="performInference">Perform inference for this simulation</label><br>
	 	<input name="useInitialSimParams" id="useInitialSimParams" type="checkbox" value="true" checked="checked"/>
	    <label for="useInitialSimParams">Use simulation parameters as initial state parameters</label><br>
	  <input type="submit" value="Simulate">
	#{/form}
</div>

<div id="upload" style="padding: 2px; border: 1px solid black">
<h3>Load Trace Data</h3> The values below determine the initial states for the loaded trace.  
	 #{form @Application.uploadHandler(), enctype:'multipart/form-data'}
   
    <select name="particleFilterTypeName">
     	#{list items:particleFilters, as:'particleFilter'}
      <option value="${particleFilter}">${particleFilter}</option>
      #{/list}
    </select><br>
    <select name="roadFilterTypeName">
     	#{list items:roadFilters, as:'roadFilter'}
      <option value="${roadFilter}">${roadFilter}</option>
      #{/list}
    </select><br>
	 	<input name="seed_str" type="text" value="0"/>
	   <label for="seed_str">Random seed (enter 0 for none)</label><br>
	 	<input name="obs_variance_pair" type="text" value="100, 100"/> 
	   <label for="obs_variance_pair">Observation Variance (x,y) in meters</label><br>
	 	<input name="obsCovDof_str" type="text" value="20"/> 
	   <label for="obsCovDof_str">Observation Variance Prior Degrees of Freedom</label><br>
	 	<input name="road_state_variance" type="text" value="6.25e-4"/> 
	   <label for="road_state_variance">On-road State Variance (errors due to acceleration)</label><br>
	 	<input name="roadCovDof_str" type="text" value="20"/> 
	   <label for="roadCovDof_str">On-road State Variance Prior Degrees of Freedom</label><br>
	 	<input name="ground_state_variance_pair" type="text" value="6.25e-4, 6.25e-4"/> 
	    <label for="ground_state_variance_pair">Off-road State Variance (errors due to acceleration, (x,y))</label><br>
	 	<input name="groundCovDof_str" type="text" value="20"/> 
	   <label for="groundCovDof_str">Off-road State Variance Prior Degrees of Freedom</label><br>
	 	<input name="off_prob_pair" type="text" value="5, 95"/>
	    <label for="off_prob_pair">Off- to off-road, off- to on-road weights (unnormalized)</label><br>
	 	<input name="on_prob_pair" type="text" value="95, 5"/>
	    <label for="on_prob_pair">On- to on-road, on- to off-road weights (unnormalized)</label><br>
	 	<input name="numParticles_str" type="text" value="25"/>
	    <label for="numParticles_str">Number of particles</label><br>
	 	<input name="initialObsFreq_str" type="text" value="30"/>
	    <label for="initialObsFreq_str">Initial Observation Frequency (seconds)</label><br>
	 	<input name="debugEnabled" id="debugEnabled" type="checkbox" value="true"/>
	    <label for="enableDebug">Enable debug for this trace</label><br>
		<input name="csv" type="file"/> <input type="submit"/>
	 #{/form}
</div>

<div id="defaultParams" style="padding: 2px; border: 1px solid black">
<h3>Default Initial State Parameters</h3>  
These values are used to initialize states when new instances are created from streaming data.
	#{form @Application.setDefaultVehicleStateParams(), method:'GET'}
    <select name="particleFilterTypeName">
     	#{list items:particleFilters, as:'particleFilter'}
      <option value="${particleFilter}">${particleFilter}</option>
      #{/list}
    </select><br>
    <select name="roadFilterTypeName">
     	#{list items:roadFilters, as:'roadFilter'}
      <option value="${roadFilter}">${roadFilter}</option>
      #{/list}
    </select><br>
	 	<input name="obs_variance_pair" type="text" 
      value="${initialParams.obsCov.getElement(0)}, ${initialParams.obsCov.getElement(1)}"/> 
	   <label for="obs_variance_pair">Observation Variance (x,y) in meters</label><br>
	 	<input name="obsCovDof_str" type="text" value="${initialParams.obsCovDof}"/> 
	   <label for="obsCovDof_str">Observation Variance Prior Degrees of Freedom</label><br>
	 	<input name="road_state_variance" type="text" value="${initialParams.onRoadStateCov.getElement(0)}"/> 
	   <label for="road_state_variance">On-road State Variance (errors due to acceleration)</label><br>
	 	<input name="roadCovDof_str" type="text" value="${initialParams.onRoadCovDof}"/> 
	   <label for="roadCovDof_str">On-road State Variance Prior Degrees of Freedom</label><br>
	 	<input name="ground_state_variance_pair" type="text" 
      value="${initialParams.offRoadStateCov.getElement(0)}, ${initialParams.offRoadStateCov.getElement(1)}"/> 
	    <label for="ground_state_variance_pair">Off-road State Variance (errors due to acceleration, (x,y))</label><br>
	 	<input name="groundCovDof_str" type="text" value="${initialParams.offRoadCovDof}"/> 
	   <label for="groundCovDof_str">Off-road State Variance Prior Degrees of Freedom</label><br>
	 	<input name="off_prob_pair" type="text" 
      value="${initialParams.offTransitionProbs.getElement(0)}, ${initialParams.offTransitionProbs.getElement(1)}"/>
	    <label for="off_prob_pair">Off- to off-road, off- to on-road weights (unnormalized)</label><br>
	 	<input name="on_prob_pair" type="text" 
      value="${initialParams.onTransitionProbs.getElement(0)}, ${initialParams.onTransitionProbs.getElement(1)}"/>
	    <label for="on_prob_pair">On- to on-road, on- to off-road weights (unnormalized)</label><br>
	 	<input name="numParticles_str" type="text" value="${initialParams.numParticles}"/>
	    <label for="numParticles_str">Number of particles</label><br>
	 	<input name="initialObsFreq_str" type="text" value="${initialParams.initialObsFreq}"/>
	    <label for="initialObsFreq_str">Initial Observation Frequency (seconds)</label><br>
	  <input type="submit" value="Change Default Initial Parameters">
	#{/form}
</div>
</body>
</html>
