<html>
<head>
	<title>Tracking Demo</title>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.css" />
 	<!--[if lte IE 8]>
    	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.ie.css" />
 	<![endif]-->
 	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
	 <div id="map"></div>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
 	<script src="http://cdn.leafletjs.com/leaflet-0.4/leaflet.js"></script>
 	<script type="text/javascript">
 		$( document ).ready(function() {
			var map = L.map('map').setView([40.7, -74], 13);
			L.tileLayer('http://{s}.tiles.mapbox.com/v3/openplans.map-b64xaary/{z}/{x}/{y}.png', {
    			attribution: 'Hi',
    			maxZoom: 18
			}).addTo(map);

			var geoJsonLayer;

			function onMapClick(e) {

				if (geoJsonLayer) {
					map.removeLayer(geoJsonLayer);
				}

    			$.getJSON(
    				'http://localhost:9998/vehicles/9992/update?callback=?', 
    				{ lat : e.latlng.lat, lon : e.latlng.lng },
    				function(data) {

    					geoJsonLayer = L.geoJson().addTo(map);
    					geoJsonLayer.addData(data);

    					// data.forEach(function(value, index, ar) {
    					// 	if (value.location) {
    					// 		geoJsonLayer.addData(value.location);
    					// 	}
    					// 	if (value.path) {
    					// 		geoJsonLayer.addData(value.path);
    					// 	}
  							
    					// });
  					}
  				);
			}

			map.on('click', onMapClick);
        });
 	</script>
</body>
</html>